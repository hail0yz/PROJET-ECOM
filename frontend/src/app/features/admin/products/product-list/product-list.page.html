<admin-layout>
    <div class="min-h-screen bg-gray-50">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Gérer vos produits</h1>
                        <p class="mt-1 text-sm text-gray-600">
                            Voici la liste de tous les produits de votre boutique. Vous pouvez en ajouter, modifier ou
                            supprimer.
                        </p>
                    </div>
                    <button routerLink="/admin/products/create"
                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        Ajouter un produit
                    </button>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col gap-4">
                <!-- Filters and Search -->
                <div class="bg-white shadow-sm rounded-lg mb-6 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold text-gray-900">Recherche et filtres</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                        <!-- Recherche -->
                        <div class="md:col-span-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Recherche</label>
                            <div class="relative">
                                <input #q (keyup.enter)="onSearch(q.value)" type="text"
                                    placeholder="Rechercher par titre, auteur, ISBN..."
                                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                                <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                        </div>

                        <!-- Catégorie -->
                        <div class="md:col-span-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Catégorie</label>
                            <select [ngModel]="filters().category?.toString() || ''"
                                (ngModelChange)="onCategoryChange($event)"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Toutes les catégories</option>
                                @for(category of categories(); track category.id) {
                                <option [value]="category.id.toString()">{{ category.name }}</option>
                                }
                            </select>
                        </div>

                        <!-- Bouton Rechercher -->
                        <div class="md:col-span-2 flex items-end">
                            <button (click)="onSearch(q.value)"
                                class="w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                Rechercher
                            </button>
                        </div>
                    </div>
                </div>

                @if (loading()) {
                @for (i of [1,2,3,4,5,6,7,8,9,10]; track i) {
                <tr class="border-b border-gray-200">
                    <td class="p-2">
                        <div class="w-4 h-4 bg-gray-200 rounded animate-pulse"></div>
                    </td>
                    <td class="p-2">
                        <div class="w-16 h-4 bg-gray-200 rounded animate-pulse"></div>
                    </td>
                    <td class="p-2">
                        <div class="w-32 h-4 bg-gray-200 rounded animate-pulse"></div>
                    </td>
                    <td class="p-2">
                        <div class="w-24 h-4 bg-gray-200 rounded animate-pulse"></div>
                    </td>
                    <td class="p-2">
                        <div class="w-20 h-4 bg-gray-200 rounded animate-pulse"></div>
                    </td>
                    <td class="p-2">
                        <div class="w-16 h-4 bg-gray-200 rounded animate-pulse"></div>
                    </td>
                    <td class="p-2">
                        <div class="flex gap-2">
                            <div class="w-20 h-8 bg-gray-200 rounded animate-pulse"></div>
                        </div>
                    </td>
                </tr>
                }
                } @else if (error()) {
                <div class="flex flex-col items-center justify-center gap-4">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6 w-full max-w-2xl">
                        <div class="flex items-start gap-4">
                            <svg class="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-red-800 mb-1">Une erreur
                                    est
                                    survenue</h3>
                                <p class="text-red-700">{{ error() }}</p>
                            </div>
                        </div>
                    </div>
                    <button (click)="loadBooks(filters())"
                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm hover:shadow-md">
                        <svg class="inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Réessayer
                    </button>
                </div>
                } @else {
                <!-- Results Summary -->
                <div class="mb-4 flex items-center justify-between">
                    <p class="text-sm text-gray-600">
                        <span class="font-semibold text-gray-900">{{ pagedBooks()?.totalElements || 0 }}</span>
                        produit(s) trouvé(s)
                    </p>
                    <div class="text-sm text-gray-600">
                        Page {{ filters().page }} sur {{ pagedBooks()?.totalPages || 1 }}
                    </div>
                </div>
                <div class="bg-white shadow-sm rounded-lg overflow-hidden">
                    <div data-slot="table-container" class="relative w-full overflow-x-auto">
                        <table data-slot="table" class="w-full caption-bottom text-sm">
                            <thead data-slot="table-header" class="[&amp;_tr]:border-b border-gray-200">
                                <tr data-slot="table-row"
                                    class="hover:bg-muted/50 data-[state=selected]:bg-muted border-b  border-gray-200 transition-colors">
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]"
                                        colspan="1">
                                        <button type="button" role="checkbox" aria-checked="false"
                                            data-state="unchecked" value="on" data-slot="checkbox"
                                            class="peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 translate-y-[2px]"
                                            aria-label="Select all">
                                        </button>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap"
                                        colspan="1">
                                        <div class="flex items-center gap-2">ID</div>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap"
                                        colspan="1">
                                        <div class="flex items-center gap-2">ISBN 10</div>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap"
                                        colspan="1">
                                        <div class="flex items-center gap-2">ISBN 13</div>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]"
                                        colspan="1">
                                        <div class="flex items-center gap-2">
                                            Titre
                                        </div>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]"
                                        colspan="1">
                                        <div class="flex items-center gap-2">
                                            Auteur
                                        </div>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]"
                                        colspan="1">
                                        <div class="flex items-center gap-2">
                                            Catégorie
                                        </div>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]"
                                        colspan="1">
                                        <div class="flex items-center gap-2">
                                            Publié en
                                        </div>
                                    </th>
                                    <th data-slot="table-head"
                                        class="text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&amp;:has([role=checkbox])]:pr-0 [&amp;&gt;[role=checkbox]]:translate-y-[2px]"
                                        colspan="1">
                                        <div class="flex items-center gap-2">Actions</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody data-slot="table-body" class="[&_tr:last-child]:border-0">
                                @for (book of pagedBooks()?.content ?? []; track book.id) {
                                <tr
                                    class="hover:bg-muted/50 data-[state=selected]:bg-muted border-b border-gray-200 transition-colors">
                                    <td class="p-2 align-middle whitespace-nowrap">
                                        <button type="button" role="checkbox" aria-checked="false"
                                            data-state="unchecked" value="on" data-slot="checkbox"
                                            class="peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 translate-y-[2px]"
                                            aria-label="Select row"></button>
                                    </td>
                                    <td class="p-2 align-middle whitespace-nowrap">
                                        <div class="w-[80px]">#{{ book.id }}</div>
                                    </td>
                                    <td class="p-2 align-middle whitespace-nowrap">{{ book.isbn10 }}</td>
                                    <td class="p-2 align-middle whitespace-nowrap">{{ book.isbn13 }}</td>
                                    <td class="p-2 align-middle whitespace-nowrap">{{ book.title }}</td>
                                    <td class="p-2 align-middle whitespace-nowrap">{{ book.author }}</td>
                                    <td class="p-2 align-middle whitespace-nowrap">{{ book.category?.name }}</td>
                                    <td class="p-2 align-middle whitespace-nowrap">{{ book.publishedYear }}</td>
                                    <td class="p-2 align-middle whitespace-nowrap">
                                        <div class="flex items-center gap-2">
                                            <a [routerLink]="['/admin/products', book.id]"
                                                class="cursor-pointer inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 bg-blue-700 text-primary-foreground shadow-xs hover:bg-blue-700/90 h-8 rounded-md gap-1.5 px-3">
                                                Modifier
                                            </a>
                                            <!-- <button
                                            class="cursor-pointer inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 bg-destructive text-primary-foreground shadow-xs hover:bg-destructive/90 h-8 rounded-md gap-1.5 px-3">Supprimer</button> -->
                                        </div>
                                    </td>
                                </tr>
                                } @empty {
                                <tr>
                                    <td colspan="7" class="p-4 text-center">Aucun produit trouvé.</td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                }

                @if (!loading()) {
                <div class="flex items-center justify-between px-2">
                    <div class="text-muted-foreground flex-1 text-sm">
                        {{ pagedBooks()?.size }} sur {{ pagedBooks()?.totalElements }} ligne(s) sélectionnée(s).
                    </div>

                    @if (pagedBooks()?.content?.length) {
                    <nav class="flex justify-center">
                        <ul data-slot="pagination-content" class="flex flex-row items-center gap-1">
                            <li>
                                <button
                                    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-9 py-2 has-[&gt;svg]:px-3 gap-1 px-2.5 sm:pl-2.5"
                                    [disabled]="pagedBooks()?.first" aria-label="Go to previous page" type="button"
                                    (click)="goToPage(1)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="lucide lucide-chevrons-left-icon lucide-chevrons-left">
                                        <path d="m11 17-5-5 5-5" />
                                        <path d="m18 17-5-5 5-5" />
                                    </svg>
                                </button>
                            </li>
                            <li>
                                <button
                                    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-9 py-2 has-[&gt;svg]:px-3 gap-1 px-2.5"
                                    [disabled]="pagedBooks()?.first" aria-label="Go to previous page" type="button"
                                    (click)="goToPage(filters().page - 1)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="lucide lucide-chevron-left">
                                        <path d="m15 18-6-6 6-6"></path>
                                    </svg>
                                </button>
                            </li>

                            @for(p of pages(); track p) {
                            <li>
                                <button
                                    class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 size-9"
                                    [class.bg-accent]="p === pagedBooks()!.number + 1"
                                    [class.text-accent-foreground]="p === pagedBooks()!.number + 1"
                                    (click)="goToPage(p)">
                                    {{ p }}
                                </button>
                            </li>
                            }
                            <li>
                                <button
                                    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-9 py-2 has-[&gt;svg]:px-3 gap-1 px-2.5 sm:pr-2.5"
                                    [disabled]="pagedBooks()?.last" (click)="goToPage(filters().page + 1)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="lucide lucide-chevron-right">
                                        <path d="m9 18 6-6-6-6"></path>
                                    </svg>
                                </button>
                            </li>
                            <li>
                                <button
                                    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-9 py-2 has-[&gt;svg]:px-3 gap-1 px-2.5 sm:pr-2.5"
                                    [disabled]="pagedBooks()?.last" (click)="goToPage(pagedBooks()!.totalPages)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="lucide lucide-chevrons-right-icon lucide-chevrons-right">
                                        <path d="m6 17 5-5-5-5" />
                                        <path d="m13 17 5-5-5-5" />
                                    </svg>
                                </button>
                            </li>
                        </ul>
                    </nav>
                    }
                </div>
                }
            </div>
        </div>
    </div>
</admin-layout>